{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\n\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nimport axios from 'axios';\n\nconst API_KEY = \"36166907-2dc6449c4338604cccc5458ef\"\nconst BASE_URL = \"https://pixabay.com/api/\"\n\nlet currentPage = 1;\nlet currentSearch = \"\";\nlet totalHits = 0;\nlet cardHeight = 0;\n\nconst form = document.querySelector(\".js_form\");\nconst imageList = document.querySelector(\".js_list\");\nconst loader = document.querySelector(\".loader\")\nconst input = document.querySelector(\"input\")\nconst loadMoreBtn = document.querySelector(\"#load_more_btn\")\n\n\nform.addEventListener(\"submit\", onSearch);\n\nloadMoreBtn.addEventListener(\"click\", loadMoreImages)\n\nasync function onSearch(event) {\n    event.preventDefault()\n\n    const searchQuery = input.value.trim()\n\n    if (!searchQuery) {\n        return        \n    }\n\n    currentSearch = searchQuery\n    currentPage = 1\n\n    showLoader(loader)\n\n    try {\n        const { images, total } = await fetchImages(currentSearch, currentPage)\n        totalHits = total\n\n        renderGallery(images)\n\n        await toggleLoadeMoreBtn(images.length)\n    } catch (error) {\n     hendleError(error)   \n    }\n    finally {\n        hideLoader(loader)\n        form.reset()\n    }\n}\n\nasync function loadMoreImages() {\n    showLoader(loader)\n\n    currentPage += 1\n\n    try {\n        const { images, total } = await fetchImages(currentSearch, currentPage)\n        totalHits = total\n\n        renderGallery(images, true)\n\n        await toggleLoadeMoreBtn(images.length)\n\n    //     window.scrollBy({\n    //     top: cardHeight * 2,\n    //     behavior: 'smooth',\n    // });\n    } catch (error) {\n     hendleError(error)   \n    }\n    finally {\n        hideLoader(loader)\n    }\n}\n\nasync function toggleLoadeMoreBtn(imagesCount) {\n    if (currentPage * 40 >= totalHits) {\n        loadMoreBtn.style.display = \"none\"\n        if (imagesCount > 0) {\n            await iziToast.info({\n                title: \"info\",\n                message: \"We're sorry, but you've reached the end of search results.\"\n        })\n    }\n    }\n    else {\n        loadMoreBtn.style.display = \"block\"\n    }\n\n}\n\nasync function fetchImages(query, page) {\n    const perPage = 40;\n    const url = `${BASE_URL}?key=${API_KEY}&q=${query}&image_type=photo&orientation=horizontal&safesearch=true&page=${page}&per_page=${perPage}`;\n\n    try {\n        const response = await axios.get(url)\n\n        if (response.status !== 200) {\n            throw new Error(\"Network response was not ok!\")\n        }\n        const { hits, totalHits } = response.data\n        \n        if (hits.length > 0 && currentPage === 1) {\n            const firstCard = document.querySelector(\".description_img\")\n            if (firstCard) {\n                cardHeight = firstCard.getBoundingClientRect().height\n\n                 window.scrollBy({\n                 top: cardHeight * 2,\n                behavior: 'smooth',\n             });\n            }\n        }\n        return {images: hits, total: totalHits}\n    } catch (error) {\n        throw error\n    }\n} \n\nfunction renderGallery(images, append = false) {\n    if (!append) {\n        imageList.innerHTML = \"\"\n        \n    }\n    if (images.length === 0 && currentPage === 1) {\n        iziToast.info({\n            title: \"Info\",\n            message: \"Sorry, there are no images matching your search query. Please try again!\",\n        })\n        loadMoreBtn.style.display = \"none\"\n        return\n    }\n    const galleryHTML = createMarkup(images)\n\n    imageList.innerHTML += galleryHTML\n\n    let lightbox = new SimpleLightbox('.js_list a', {\n    captionSelector: 'img',\n    captionsData: 'alt',\n    captionDelay: 250\n    });\n\n    lightbox.refresh()\n}\n\nfunction createMarkup(array) {\n    return array.map(({ webformatURL, largeImageURL, tags, likes, views, comments, downloads }) => `\n<li class=\"description_img\">\n  <a href=\"${largeImageURL}\">\n    <img class=\"gallery_image\" src=\"${webformatURL}\" alt=\"${tags}\" width=\"350\" height=\"250\">\n  </a>\n  <ul class=\"description_list\">\n    <li class=\"description_item\">\n      <h2>Likes</h2>\n      <p>${likes}</p>\n    </li>\n    <li class=\"description_item\">\n      <h2>Views</h2>\n      <p>${views}</p>\n    </li>\n    <li class=\"description_item\">\n      <h2>Comments</h2>\n      <p>${comments}</p>\n    </li>\n    <li class=\"description_item\">\n      <h2>Downloads</h2>\n      <p>${downloads}</p>\n    </li>\n  </ul>\n</li>`).join(\"\")\n}\n\nfunction hendleError(error) {\n    console.error(\"Error fetch images\", error)\n    const errorMessage = error.response && error.response.status === 404 ? \"Sorry, there are no images matching your search query. Please try again!\": \"An error occurred while fetching images. Please try again later.\"\n\n    iziToast.error({\n        title: \"Error\",\n        message: errorMessage\n    })\n}\n\nfunction showLoader(loader) {\n    loader.style.display = \"block\"\n}\nfunction hideLoader(loader) {\n    loader.style.display = \"none\"\n}"],"names":["API_KEY","BASE_URL","currentPage","currentSearch","totalHits","cardHeight","form","imageList","loader","input","loadMoreBtn","onSearch","loadMoreImages","event","searchQuery","showLoader","images","total","fetchImages","renderGallery","toggleLoadeMoreBtn","error","hendleError","hideLoader","imagesCount","iziToast","query","page","url","response","axios","hits","firstCard","append","galleryHTML","createMarkup","SimpleLightbox","array","webformatURL","largeImageURL","tags","likes","views","comments","downloads","errorMessage"],"mappings":"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"}